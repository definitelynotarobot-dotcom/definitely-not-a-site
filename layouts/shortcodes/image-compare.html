{{- $before := .Get "before" -}}
{{- $after := .Get "after" -}}
{{- $alt := .Get "alt" | default "Before and after comparison" -}}

<div class="image-compare-container">
  <div class="image-compare-wrapper">
    <div class="image-compare-after-wrapper">
      <img src="{{ $after }}" alt="{{ $alt }} - After" class="image-compare-after">
    </div>
    <div class="image-compare-before-wrapper">
      <img src="{{ $before }}" alt="{{ $alt }} - Before" class="image-compare-before">
    </div>
    <div class="image-compare-slider">
      <div class="image-compare-handle">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="15 18 9 12 15 6"></polyline>
        </svg>
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="9 18 15 12 9 6"></polyline>
        </svg>
      </div>
    </div>
  </div>
</div>

<style>
.image-compare-container {
  max-width: 100%;
  margin: 2rem 0;
  user-select: none;
}

.image-compare-wrapper {
  position: relative;
  cursor: ew-resize;
  line-height: 0;
  display: inline-block;
  width: 100%;
  background: transparent;
}

.image-compare-after-wrapper {
  position: relative;
  width: 100%;
  display: block;
  background: transparent;
}

.image-compare-after {
  display: block;
  width: 100%;
  height: auto;
  background: transparent;
}

.image-compare-before-wrapper {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  overflow: hidden;
  clip-path: inset(0 100% 0 0);
  background: transparent;
}

.image-compare-before {
  display: block;
  width: 100%;
  height: 100%;
  object-fit: cover;
  object-position: left center;
  background: transparent;
}

.image-compare-slider {
  position: absolute !important;
  top: 0 !important;
  bottom: 0 !important;
  left: 0% !important;
  width: 2px !important;
  height: auto !important;
  background: rgba(255, 255, 255, 0.8) !important;
  cursor: ew-resize !important;
  transform: translateX(-50%) !important;
  box-shadow: 0 0 5px rgba(0, 0, 0, 0.3) !important;
  z-index: 10 !important;
  pointer-events: none !important;
}

.image-compare-handle {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 50px;
  height: 50px;
  background: rgba(255, 255, 255, 0.95);
  border: 2px solid rgba(0, 0, 0, 0.2);
  border-radius: 50%;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 2px;
  pointer-events: auto;
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.image-compare-handle:hover {
  transform: translate(-50%, -50%) scale(1.1);
  box-shadow: 0 3px 15px rgba(0, 0, 0, 0.4);
  background: rgba(255, 255, 255, 1);
}

.image-compare-handle svg {
  width: 18px;
  height: 18px;
  color: #333;
  stroke-width: 3;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  console.log('Image compare script loaded');
  const containers = document.querySelectorAll('.image-compare-container');
  console.log('Found containers:', containers.length);
  
  containers.forEach(function(container) {
    const wrapper = container.querySelector('.image-compare-wrapper');
    const beforeWrapper = container.querySelector('.image-compare-before-wrapper');
    const slider = container.querySelector('.image-compare-slider');
    
    let isDragging = false;
    
    function updateSlider(clientX) {
      const rect = wrapper.getBoundingClientRect();
      let x = clientX - rect.left;
      x = Math.max(0, Math.min(x, rect.width));
      const percentage = (x / rect.width) * 100;
      
      beforeWrapper.style.clipPath = 'inset(0 ' + (100 - percentage) + '% 0 0)';
      slider.style.left = percentage + '%';
    }
    
    function startDrag(e) {
      isDragging = true;
      e.preventDefault();
      updateSlider(e.type.includes('mouse') ? e.clientX : e.touches[0].clientX);
    }
    
    function drag(e) {
      if (!isDragging) return;
      e.preventDefault();
      updateSlider(e.type.includes('mouse') ? e.clientX : e.touches[0].clientX);
    }
    
    function stopDrag() {
      isDragging = false;
    }
    
    wrapper.addEventListener('mousedown', startDrag);
    document.addEventListener('mousemove', drag);
    document.addEventListener('mouseup', stopDrag);
    
    wrapper.addEventListener('touchstart', startDrag, { passive: false });
    document.addEventListener('touchmove', drag, { passive: false });
    document.addEventListener('touchend', stopDrag);
  });
});
</script>